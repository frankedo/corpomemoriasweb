<!DOCTYPE html>
<html lang="es">
<head>

     <meta charset="utf-8">
    <meta name="google-site-verification@corpomemorias.netlify.app" content="6Jg75i6_BVhEGzpzF3FTG7wEbW5mF48oGYLUYFc8Gyk">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sitio oficial de la Corporaci贸n Marl贸n Memorias y Huellas de un Desaparecido - Corpomemorias Aguachica. Luchamos por la dignidad de los desaparecidos en Colombia.">
    <meta name="author" content="Devcrud">

    <meta name="keywords" content="Corpomemorias, memoria hist贸rica, desaparici贸n forzada, v铆ctimas, museo virtual, cultura, resistencia, Colombia" />

    <title>CORPOMEMORIAS</title>

    <link rel="canonical" href="https://corpomemorias.netlify.app">
    <meta property="og:title" content="Corpomemorias | Memoria y Dignidad">
    <meta property="og:description" content="Preservamos la memoria de los desaparecidos en Colombia. Conoce nuestra lucha y participa.">
    <meta property="og:image" content="https://corpomemorias.netlify.app/assets/imgs/og-image.jpg">
    <meta property="og:url" content="https://corpomemorias.netlify.app">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Corpomemorias | Memoria y Dignidad">
    <meta name="twitter:description" content="Preservamos la memoria de los desaparecidos en Colombia. Conoce nuestra lucha y participa.">
    <meta name="twitter:image" content="https://corpomemorias.netlify.app/assets/imgs/og-image.jpg">

    <!-- Lightbox CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js" defer></script>

    <link rel="stylesheet" href="../assets/vendors/themify-icons/css/themify-icons.css">
    <link rel="stylesheet" href="../assets/css/creative-design.css">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    .card {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .card-img-top {
        height: 250px;
        object-fit: cover;
        background: #f0f0f0;
    }
    .loader {
        width: 100%;
        height: 250px;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #eee;
        color: #555;
        font-size: 18px;
    }
</style>

</head>

<body data-spy="scroll" data-target=".navbar" data-offset="40" id="home">
    
    <!-- NAVBAR -->
    <nav id="scrollspy" class="navbar page-navbar navbar-light navbar-expand-md fixed-top" data-spy="affix" data-offset-top="20">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <strong class="text-primary">Corporaci贸n</strong> 
                <span class="text-dark">Marl贸n Memorias</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

<!-- HEADER -->
<header id="home" class="header">
    <div class="overlay"></div>
    <div class="header-content" style="display: flex; flex-direction: column; align-items: center;">
        <p>Corporaci贸n Marl贸n Memorias y Huellas de un Desaparecido</p>
        <h6>Publicaciones</h6>

        <a href="https://wa.me/+573044868541?text=隆Hola!%20Quisiera%20m谩s%20informaci贸n"
           target="_blank" class="btn btn-outline-light"
           style="display: flex; align-items: center; width: 250px; justify-content: center;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/WhatsApp_icon.png"
                 style="width: 20px; height: 20px; margin-right: 8px;">
           Con茅ctate con nosotros
        </a>
    </div>
</header>

<!--  FILTROS -->
<div class="container py-4">
    <div class="row">

     

        <div class="col-md-4 mb-3">
            <label><strong>Tipo de publicaci贸n</strong></label>
            <select id="filtro-tipo" class="form-control">
                <option value="">Todos</option>
                <option value="informe">Informe</option>
                <option value="boletin">Bolet铆n</option>
                <option value="revista">Revista</option>
                <option value="libro">Libro</option>
                <option value="taller">Taller</option>
            </select>
        </div>

        <div class="col-md-4 mb-3">
            <label><strong>A帽o</strong></label>
            <select id="filtro-anio" class="form-control">
                <option value="">Todos</option>
                <option>2020</option>
                <option>2021</option>
                <option>2022</option>
                <option>2023</option>
                <option>2024</option>
                <option>2025</option>
            </select>
        </div>

    </div>
</div>


<!-- CONTENEDOR DE PUBLICACIONES -->
<div class="container py-5">
    <div id="lista-publicaciones" class="row"></div>
</div>


<!-- PDF.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

async function obtenerPortadaPDF(urlPDF) {
    try {
        const loadingTask = pdfjsLib.getDocument(urlPDF);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1);

        const viewport = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport }).promise;

        return canvas.toDataURL();
    } catch (err) {
        console.error("Error cargando portada:", err);
        return "https://placehold.co/300x400?text=Sin+Portada";
    }
}
</script>


<!-- SCRIPT PRINCIPAL -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const contenedor = document.getElementById("lista-publicaciones");
    const backendURL = "https://supabase-backend-1-g0bt.onrender.com";

    let publicacionesDatos = [];

    try {
        const res = await fetch(`${backendURL}/publicaciones`);
        publicacionesDatos = await res.json();

        renderPublicaciones(publicacionesDatos);

    } catch (err) {
        console.error("Error cargando publicaciones:", err);
        contenedor.innerHTML =
            `<div class="col-12"><div class="alert alert-danger">Error cargando publicaciones.</div></div>`;
    }

    function aplicarFiltros() {
        const texto = document.getElementById("buscar-texto").value.toLowerCase();
        const tipo = document.getElementById("filtro-tipo").value;
        const anio = document.getElementById("filtro-anio").value;

        const filtradas = publicacionesDatos.filter(pub => {
            const coincideTexto =
                pub.titulo.toLowerCase().includes(texto) ||
                (pub.descripcion || "").toLowerCase().includes(texto);

            const coincideTipo =
                tipo === "" || pub.tipo === tipo;

            const coincideAnio =
                anio === "" || (pub.fecha && pub.fecha.startsWith(anio));

            return coincideTexto && coincideTipo && coincideAnio;
        });

        renderPublicaciones(filtradas);
    }

    document.getElementById("buscar-texto").addEventListener("input", aplicarFiltros);
    document.getElementById("filtro-tipo").addEventListener("change", aplicarFiltros);
    document.getElementById("filtro-anio").addEventListener("change", aplicarFiltros);

    function renderPublicaciones(lista) {
        contenedor.innerHTML = "";

        lista.forEach(pub => {
            const col = document.createElement("div");
            col.className = "col-md-4 mb-4";

            col.innerHTML = `
                <div class="card">
                    <div class="loader">Cargando portada...</div>
                    <img class="card-img-top d-none portada-generada" data-pdf="${pub.url_pdf}" alt="Portada PDF">

                    <div class="card-body">
                        <h5 class="card-title">${pub.titulo}</h5>
                        <p class="card-text">${pub.descripcion || ""}</p>

                        <a href="${pub.url_pdf}" target="_blank" class="btn btn-primary btn-block">
                            Ver PDF
                        </a>
                    </div>
                </div>
            `;

            contenedor.appendChild(col);
        });

        document.querySelectorAll(".portada-generada").forEach(async img => {
            const portada = await obtenerPortadaPDF(img.dataset.pdf);
            img.previousElementSibling.classList.add("d-none");
            img.src = portada;
            img.classList.remove("d-none");
        });
    }
});
</script>

</body>
</html>
