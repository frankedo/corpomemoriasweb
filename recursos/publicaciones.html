<!DOCTYPE html>
<html lang="es">
<head>

     <meta charset="utf-8">
    <meta name="google-site-verification@corpomemorias.netlify.app" content="6Jg75i6_BVhEGzpzF3FTG7wEbW5mF48oGYLUYFc8Gyk">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sitio oficial de la Corporación Marlón Memorias y Huellas de un Desaparecido - Corpomemorias Aguachica. Luchamos por la dignidad de los desaparecidos en Colombia.">
    <meta name="author" content="Devcrud">

    <title>CORPOMEMORIAS</title>

    <!-- Lightbox CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js" defer></script>

    <!-- font icons -->
    <link rel="stylesheet" href="../assets/vendors/themify-icons/css/themify-icons.css">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="../assets/css/creative-design.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

	<!-- ICONOS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>






<style>
.card {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    height: 100%; /* Hace que la tarjeta tome toda la altura disponible del contenedor */
}

.card-img-top {
    height: 250px;
    object-fit: cover;
    background: #f0f0f0;
}

.loader {
    width: 100%;
    height: 250px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #eee;
    color: #555;
    font-size: 18px;
}

.card-body {
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1; /* Hace que el contenido de la tarjeta estire toda la tarjeta */
}

.card-body h5,
.card-body p {
    margin: 0;
    padding: 0;
    line-height: 1.2;
}

.card-text {
    flex-grow: 1; /* Empuja el botón de "Ver PDF" hacia abajo, igualando alturas */
}

.btn-block {
    margin-top: auto; /* Mantiene el botón abajo de la tarjeta */
}
</style>



	
<body>

<!-- NAV -->
<nav id="scrollspy" class="navbar page-navbar navbar-light navbar-expand-md fixed-top">
    <div class="container">
        <a class="navbar-brand" href="../index.html">
            <strong class="text-primary">Corporación</strong> 
            <span class="text-dark">Marlón Memorias</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" 
                data-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</nav>

<!-- HEADER -->
<header id="home" class="header">
    <div class="overlay"></div>
    <div class="header-content" style="display: flex; flex-direction: column; align-items: center;">
        <p>Corporación Marlón Memorias y Huellas de un Desaparecido</p>
        <h6>Publicaciones</h6>

        <a href="https://wa.me/+573044868541?text=¡Hola!%20Quisiera%20más%20información"
           target="_blank" class="btn btn-outline-light" 
           style="display: flex; align-items: center; width: 250px; justify-content: center;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/WhatsApp_icon.png"
                 style="width: 20px; height: 20px; margin-right: 8px;">
           Conéctate con nosotros
        </a>
    </div>
</header>





<!-- About Section -->
    <section id="publicaciones_observatorio">
        <!-- Container -->
        <div class="container">
            <!-- About wrapper -->
            <div class="about-wrapper">
                <div class="after"></div>
                <div class="content">

	


    <!-- FILTRO ÚNICO -->
    <div class="row mb-4">
        <div class="col-md-12">
            <select id="filtroTipo" class="form-control">
                <option value="">Filtrar por tipo</option>
                <option value="informe">Informe</option>
                <option value="boletin">Boletín</option>
                <option value="revista">Revista</option>
                <option value="libro">Libro</option>
                <option value="taller">Taller</option>
            </select>
        </div>
    </div>

    <div id="lista-publicaciones" class="row"></div>
</div>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

async function obtenerPortadaPDF(urlPDF) {
    try {
        const loadingTask = pdfjsLib.getDocument(urlPDF);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1);

        const viewport = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport }).promise;

        return canvas.toDataURL();
    } catch (err) {
        console.error("Error cargando portada:", err);
        return "https://placehold.co/300x400?text=Sin+Portada";
    }
}
</script>

<!-- SCRIPT PRINCIPAL -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const contenedor = document.getElementById("lista-publicaciones");
    const filtroTipo = document.getElementById("filtroTipo");

    const backendURL = "https://supabase-backend-1-g0bt.onrender.com";

    let publicaciones = [];

    try {
        const res = await fetch(`${backendURL}/publicaciones`);
        publicaciones = await res.json();

        renderizarTarjetas(publicaciones);

        // Filtrar solo por tipo
        filtroTipo.addEventListener("change", () => {
            let tipo = filtroTipo.value;

            let filtradas = publicaciones.filter(p => {
                return tipo ? p.tipo === tipo : true;
            });

            renderizarTarjetas(filtradas);
        });

    } catch (err) {
        console.error("Error cargando publicaciones:", err);
        contenedor.innerHTML =
            `<div class="col-12"><div class="alert alert-danger">Error cargando publicaciones.</div></div>`;
    }

    function renderizarTarjetas(data) {
        contenedor.innerHTML = "";

        data.forEach(pub => {
            const col = document.createElement("div");
         col.className = "col-6 col-md-3 mb-4";


            col.innerHTML = `
                <div class="card">
                    <div class="loader">Cargando portada...</div>
                    <img class="card-img-top d-none portada-generada" data-pdf="${pub.url_pdf}" alt="Portada PDF">

                    <div class="card-body">
                        <h5 class="card-title">${pub.titulo}</h5>

                        <p><strong>Año:</strong> ${pub.fecha ? new Date(pub.fecha).getFullYear() : "Sin año"}</p>

                        <p class="card-text">${pub.descripcion || ""}</p>

                        <a href="${pub.url_pdf}" target="_blank"
                           class="btn btn-primary btn-block mb-2">Ver PDF</a>
                    </div>
                </div>
            `;

            contenedor.appendChild(col);
        });

        document.querySelectorAll(".portada-generada").forEach(async img => {
            const urlPDF = img.dataset.pdf;
            const portada = await obtenerPortadaPDF(urlPDF);

            const loader = img.previousElementSibling;
            loader.classList.add("d-none");

            img.src = portada;
            img.classList.remove("d-none");
        });
    }

});
</script>

</body>
</html>
